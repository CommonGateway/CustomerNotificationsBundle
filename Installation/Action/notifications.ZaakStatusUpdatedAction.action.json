{
    "title": "ZaakStatusUpdatedAction",
    "$id": "https://commongateway.nl/action/notifications.ZaakStatusUpdatedAction.action.json",
    "$schema": "https://docs.commongateway.nl/schemas/Action.schema.json",
    "version": "0.0.1",
    "listens": ["notifications.notification.created"],
    "conditions":
    {
        "and": [
            {
                "==": [
                    {
                        "var": "method"
                    },
                    "POST"
                ]
            },
            {
                "==": [
                    {
                        "var": "body.kanaal"
                    },
                    "zaken"
                ]
            },
            {
                "==": [
                    {
                        "var": "body.resource"
                    },
                    "status"
                ]
            },
            {
                "==": [
                    {
                        "var": "body.actie"
                    },
                    "update"
                ]
            }
        ]
    },
    "class": "CommonGateway\\CustomerNotificationsBundle\\ActionHandler\\NotificationsHandler",
    "configuration": {
        "extraConditions": {
            "getObjectDataConfig": {
                "source": "https://buren.nl/source/buren.zrc.source.json",
                "notificationProperty": "body.resourceUrl",
                "sourceProperties": ["statustype"],
                "getObjectDataConfig": {
                    "forParentProperties": ["statustype"],
                    "source": "https://buren.nl/source/buren.ztc.source.json",
                    "sourceProperties": ["isEindstatus"]
                }
            },
            "conditions": {
                "isEindstatus": false
            }
        },
        "emailConfig": {
            "getObjectDataConfig": {
                "source": "https://buren.nl/source/buren.zrc.source.json",
                "sourceEndpoint": "/rollen",
                "sourceQuery": {
                    "zaak": "{{body.hoofdObject}}",
                    "omschrijvingGeneriek": "initiator"
                },
                "sourceProperties": ["results.0.betrokkeneIdentificatie.inpBsn"],
                "searchSchemas": ["https://commongateway.nl/klant.partij.schema.json"],
                "searchQuery": {
                    "externeIdentificaties.partijIdentificator.objectId": "{{results.0.betrokkeneIdentificatie.inpBsn}}",
                    "externeIdentificaties.partijIdentificator.objecttype": "ingeschrevenpersoon"
                }
            },
            "throw": "notifications.zaak.status.updated.email"
        },
        "smsConfig": {
            "getObjectDataConfig": "sameAsEmail",
            "throw": "notifications.zaak.status.updated.sms"
        },
        "createObjectConfig": {
            "schema": "Entity ref or uuid",
            "mapping": "Mapping ref or uuid"
        }
    }
}